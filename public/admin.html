<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | EcoCalc</title>
    <meta name="description" content="Admin control panel for EcoCalc calculator configuration.">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="logo-icon.png">
</head>

<body>
    <!-- Login Overlay -->
    <div id="loginOverlay" class="admin-login-overlay">
        <div class="admin-login-card">
            <div class="admin-login-header">
                <i class="bi bi-shield-lock"></i>
                <h3 data-i18n="admin_login_title">Admin Access</h3>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label-custom" for="adminPassword">
                        <i class="bi bi-key"></i>
                        <span data-i18n="admin_password_label">Password</span>
                    </label>
                    <input type="password" class="form-control-custom" id="adminPassword"
                        placeholder="Enter admin password" required autofocus>
                </div>
                <div id="loginError" class="form-warning d-none">
                    <i class="bi bi-exclamation-circle"></i>
                    <span data-i18n="admin_login_error">Incorrect password</span>
                </div>
                <button type="submit" class="btn-calculate" style="margin-top: 1rem;">
                    <i class="bi bi-unlock"></i>
                    <span data-i18n="admin_login_btn">Access Panel</span>
                </button>
            </form>
            <a href="/" class="admin-back-link">
                <i class="bi bi-arrow-left"></i>
                <span data-i18n="admin_back_to_calc">Back to Calculator</span>
            </a>

            <!-- Language Switcher on Login Page -->
            <div class="login-lang-switcher">
                <div class="lang-switcher" id="loginLangSwitcher">
                    <button class="lang-btn" id="loginLangBG" data-lang="bg">BG</button>
                    <button class="lang-btn" id="loginLangEN" data-lang="en">EN</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel (hidden until login) -->
    <div id="adminPanel" class="d-none">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <img src="logo-icon.png" alt="EcoCalc Logo" class="navbar-logo">
                    <span>EcoCalc</span>
                    <span class="admin-badge">Admin</span>
                </a>

                <div class="d-flex align-items-center gap-3">
                    <button class="btn-theme-toggle" id="themeToggle">
                        <i class="bi bi-sun-fill"></i>
                    </button>
                    <div class="lang-switcher" id="langSwitcher">
                        <button class="lang-btn" id="langBG" data-lang="bg">BG</button>
                        <button class="lang-btn" id="langEN" data-lang="en">EN</button>
                    </div>
                    <button class="btn-logout" id="logoutBtn">
                        <i class="bi bi-box-arrow-right"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Admin Content -->
        <section class="admin-section">
            <div class="container">
                <div class="admin-header">
                    <h2 data-i18n="admin_panel_title">Control Panel</h2>
                    <p data-i18n="admin_panel_subtitle">Manage calculator settings, materials, and formulas</p>
                </div>

                <!-- Tab Navigation -->
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="formula">
                        <i class="bi bi-calculator"></i>
                        <span data-i18n="admin_tab_formula">Formula</span>
                    </button>
                    <button class="admin-tab" data-tab="materials">
                        <i class="bi bi-bricks"></i>
                        <span data-i18n="admin_tab_materials">Materials</span>
                    </button>
                    <button class="admin-tab" data-tab="settings">
                        <i class="bi bi-gear"></i>
                        <span data-i18n="admin_tab_settings">Settings</span>
                    </button>
                    <button class="admin-tab" data-tab="export">
                        <i class="bi bi-download"></i>
                        <span data-i18n="admin_tab_export">Export/Import</span>
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="admin-content">
                    <!-- Formula Tab -->
                    <div id="formulaTab" class="admin-tab-content active">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h4 data-i18n="admin_formula_title">Heat Loss Formula</h4>
                            </div>

                            <!-- Formula Display -->
                            <div class="formula-display">
                                <div class="formula-main">Q = U × A × ΔT</div>
                                <div class="formula-expanded" id="formulaExpanded">Q = (λ / d) × A × (T<sub>in</sub> -
                                    T<sub>out</sub>)</div>
                            </div>

                            <!-- Formula Settings -->
                            <div class="formula-settings">
                                <h5 data-i18n="admin_formula_settings">Formula Settings</h5>

                                <!-- Absolute Value Toggle -->
                                <div class="formula-toggle-row">
                                    <label class="toggle-label" for="useAbsoluteValue">
                                        <span data-i18n="admin_use_absolute">Use absolute value for ΔT</span>
                                        <small data-i18n="admin_absolute_hint">(|Tin - Tout| instead of Tin -
                                            Tout)</small>
                                    </label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="useAbsoluteValue">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Editable Formula Legend -->
                            <div class="formula-legend-editable">
                                <h5 data-i18n="admin_formula_components">Formula Components</h5>
                                <div class="formula-legend">
                                    <div class="formula-item">
                                        <span class="formula-symbol">Q</span>
                                        <input type="text" class="formula-desc-input" id="descQ" data-key="q_desc"
                                            value="Heat loss (Watts)">
                                    </div>
                                    <div class="formula-item">
                                        <span class="formula-symbol">U</span>
                                        <input type="text" class="formula-desc-input" id="descU" data-key="u_desc"
                                            value="Thermal transmittance (W/m²K)">
                                    </div>
                                    <div class="formula-item">
                                        <span class="formula-symbol">λ</span>
                                        <input type="text" class="formula-desc-input" id="descLambda"
                                            data-key="lambda_desc" value="Thermal conductivity (W/m·K)">
                                    </div>
                                    <div class="formula-item">
                                        <span class="formula-symbol">d</span>
                                        <input type="text" class="formula-desc-input" id="descD" data-key="d_desc"
                                            value="Material thickness (m)">
                                    </div>
                                    <div class="formula-item">
                                        <span class="formula-symbol">A</span>
                                        <input type="text" class="formula-desc-input" id="descA" data-key="a_desc"
                                            value="Wall area (m²)">
                                    </div>
                                    <div class="formula-item">
                                        <span class="formula-symbol">ΔT</span>
                                        <input type="text" class="formula-desc-input" id="descDeltaT" data-key="dt_desc"
                                            value="Temperature difference (°C)">
                                    </div>
                                </div>

                                <button type="button" class="btn-calculate" id="saveFormulaBtn"
                                    style="margin-top: 1rem;">
                                    <i class="bi bi-check-lg"></i>
                                    <span data-i18n="admin_save_formula">Save Formula Settings</span>
                                </button>
                            </div>

                            <div class="formula-note">
                                <i class="bi bi-info-circle"></i>
                                <span data-i18n="formula_note">The formula is based on steady-state heat transfer
                                    through a single-layer wall.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Materials Tab -->
                    <div id="materialsTab" class="admin-tab-content">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h4 data-i18n="admin_materials_title">Materials Database</h4>
                                <button class="btn-add-material" id="addMaterialBtn">
                                    <i class="bi bi-plus-lg"></i>
                                    <span data-i18n="admin_add_material">Add Material</span>
                                </button>
                            </div>
                            <div class="materials-table-container">
                                <table class="materials-table">
                                    <thead>
                                        <tr>
                                            <th data-i18n="admin_th_name_en">Name (EN)</th>
                                            <th data-i18n="admin_th_name_bg">Name (BG)</th>
                                            <th data-i18n="admin_th_lambda">
                                                λ (W/m·K)
                                                <span class="tooltip-badge" data-bs-toggle="tooltip"
                                                    data-bs-placement="top"
                                                    title="Thermal conductivity of the material, measured in W/m·K. Indicates how easily heat flows through the material.">?</span>
                                            </th>
                                            <th data-i18n="admin_th_max_thickness">Max Thickness (cm)</th>
                                            <th data-i18n="admin_th_actions">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materialsTableBody">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settingsTab" class="admin-tab-content">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h4 data-i18n="admin_settings_title">Calculator Settings</h4>
                            </div>
                            <form id="settingsForm">
                                <div class="settings-grid">
                                    <div class="settings-group">
                                        <h5 data-i18n="admin_temp_settings">Temperature Limits</h5>
                                        <div class="settings-row">
                                            <div class="form-group">
                                                <label class="form-label-custom" for="tempInMin"
                                                    data-i18n="admin_temp_in_min">Internal
                                                    Min (°C)</label>
                                                <input type="number" class="form-control-custom" id="tempInMin"
                                                    value="10">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label-custom" for="tempInMax"
                                                    data-i18n="admin_temp_in_max">Internal
                                                    Max (°C)</label>
                                                <input type="number" class="form-control-custom" id="tempInMax"
                                                    value="30">
                                            </div>
                                        </div>
                                        <div class="settings-row">
                                            <div class="form-group">
                                                <label class="form-label-custom" for="tempOutMin"
                                                    data-i18n="admin_temp_out_min">External
                                                    Min (°C)</label>
                                                <input type="number" class="form-control-custom" id="tempOutMin"
                                                    value="-30">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label-custom" for="tempOutMax"
                                                    data-i18n="admin_temp_out_max">External
                                                    Max (°C)</label>
                                                <input type="number" class="form-control-custom" id="tempOutMax"
                                                    value="50">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="settings-group">
                                        <h5 data-i18n="admin_other_settings">Other Settings</h5>
                                        <div class="settings-row">
                                            <div class="form-group">
                                                <label class="form-label-custom" for="areaMax"
                                                    data-i18n="admin_area_max">Max Area
                                                    (m²)</label>
                                                <input type="number" class="form-control-custom" id="areaMax"
                                                    value="1000">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label-custom" for="decimals"
                                                    data-i18n="admin_decimals">Decimal
                                                    Precision</label>
                                                <input type="number" class="form-control-custom" id="decimals" value="3"
                                                    min="1" max="6">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="settings-actions">
                                    <button type="submit" class="btn-calculate">
                                        <i class="bi bi-check-lg"></i>
                                        <span data-i18n="admin_save_settings">Save Settings</span>
                                    </button>
                                    <button type="button" class="btn-reset-settings" id="resetSettingsBtn">
                                        <i class="bi bi-arrow-counterclockwise"></i>
                                        <span data-i18n="admin_reset_settings">Reset to Defaults</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Export/Import Tab -->
                    <div id="exportTab" class="admin-tab-content">
                        <div class="admin-card">
                            <div class="admin-card-header">
                                <h4 data-i18n="admin_export_title">Configuration Backup</h4>
                            </div>
                            <div class="export-grid">
                                <div class="export-section">
                                    <h5 data-i18n="admin_export_heading">Export Configuration</h5>
                                    <p data-i18n="admin_export_desc">Download current settings and materials as a JSON
                                        file.</p>
                                    <button class="btn-calculate" id="exportBtn">
                                        <i class="bi bi-download"></i>
                                        <span data-i18n="admin_export_btn">Export to JSON</span>
                                    </button>
                                </div>
                                <div class="export-section">
                                    <h5 data-i18n="admin_import_heading">Import Configuration</h5>
                                    <p data-i18n="admin_import_desc">Upload a previously exported JSON file to restore
                                        settings.</p>
                                    <label class="btn-import" for="importFile">
                                        <i class="bi bi-upload"></i>
                                        <span data-i18n="admin_import_btn">Import from JSON</span>
                                    </label>
                                    <input type="file" id="importFile" accept=".json" hidden>
                                </div>
                                <div class="export-section">
                                    <h5 data-i18n="admin_reset_heading">Reset All</h5>
                                    <p data-i18n="admin_reset_desc">Clear all custom settings and restore factory
                                        defaults.</p>
                                    <button class="btn-danger" id="resetAllBtn">
                                        <i class="bi bi-trash3"></i>
                                        <span data-i18n="admin_reset_btn">Reset to Factory Defaults</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer-section" style="margin-top: 2rem;">
            <div class="container">
                <div class="footer-bottom">
                    <small>© 2025 Energy Efficiency Project | <a href="https://www.bas.bg/" target="_blank"
                            style="color: inherit; text-decoration: underline;">Bulgarian Academy of
                            Sciences</a></small>
                </div>
            </div>
        </footer>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-modal-header">
                <h4 id="modalTitle" data-i18n="admin_add_material">Add Material</h4>
                <button class="admin-modal-close" id="closeModalBtn">&times;</button>
            </div>
            <form id="materialForm">
                <input type="hidden" id="materialId">
                <div class="form-group">
                    <label class="form-label-custom" for="materialNameEn" data-i18n="admin_th_name_en">Name (EN)</label>
                    <input type="text" class="form-control-custom" id="materialNameEn" required>
                </div>
                <div class="form-group">
                    <label class="form-label-custom" for="materialNameBg" data-i18n="admin_th_name_bg">Name (BG)</label>
                    <input type="text" class="form-control-custom" id="materialNameBg" required>
                </div>
                <div class="form-group">
                    <label class="form-label-custom" for="materialLambda" data-i18n="admin_th_lambda">Thermal
                        Conductivity λ (W/m·K)</label>
                    <input type="number" step="0.001" min="0.001" class="form-control-custom" id="materialLambda"
                        required>
                </div>
                <div class="form-group">
                    <label class="form-label-custom" for="materialMaxThickness" data-i18n="admin_th_max_thickness">Max
                        Thickness (cm)</label>
                    <input type="number" step="1" min="1" class="form-control-custom" id="materialMaxThickness"
                        required>
                </div>
                <div class="admin-modal-actions">
                    <button type="button" class="btn-cancel" id="cancelModalBtn"
                        data-i18n="admin_cancel">Cancel</button>
                    <button type="submit" class="btn-calculate">
                        <i class="bi bi-check-lg"></i>
                        <span data-i18n="admin_save">Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="adminToast" class="toast align-items-center border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastMessage">
                    <i class="bi bi-check-circle-fill me-2" style="color: var(--accent-green);"></i>
                    Settings saved successfully!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Admin JS -->
    <script src="admin.js"></script>
</body>

</html>